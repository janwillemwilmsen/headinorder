# FROM node:14.1

# RUN apt-get update && \
# apt-get install -yq gconf-service libasound2 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 \
# libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 \
# libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 \
# libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 \
# fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst ttf-freefont \
# libgbm-dev libicu-dev libpng-dev \
# ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget && \
# wget https://github.com/Yelp/dumb-init/releases/download/v1.2.1/dumb-init_1.2.1_amd64.deb && \
# dpkg -i dumb-init_*.deb && rm -f dumb-init_*.deb && \
# apt-get clean && apt-get autoremove -y && rm -rf /var/lib/apt/lists/*

# # Create app directory
# WORKDIR /usr/src/app

# # Install app dependencies
# # A wildcard is used to ensure both package.json AND package-lock.json are copied
# # where available (npm@5+)
# COPY package*.json ./


# ## Added https://github.com/microsoft/playwright/issues/5767
# # RUN PLAYWRIGHT_BROWSERS_PATH=/usr/lib/playwright npm install playwright-chromium@1.20.1

# # RUN PLAYWRIGHT_BROWSERS_PATH=/usr/lib/playwright npm install playwright-webkit@1.20.1
# # RUN PLAYWRIGHT_BROWSERS_PATH=/usr/lib/playwright npm install playwright-firefox@1.20.1-


# # RUN PLAYWRIGHT_BROWSERS_PATH=/usr/lib/playwright

# # DEZE UITGESCHAKELD VOOR PUPPETEER
# # ENV PLAYWRIGHT_BROWSERS_PATH=0

# # 10 5.850 > puppeteer@9.1.1 install       /usr/src/app/node_modules/puppeteer
# # 10 125.3 Chromium (869685) downloaded to /usr/src/app/node_modules/pa11y/node_modules/puppeteer/.local-chromium/linux-869685
# # Add user so we don't need --no-sandbox.
#     # same layer as npm install to keep re-chowned files from using up several hundred MBs more space
# RUN npm init -y &&  \
#     npm install \
#     # npm i puppeteer \
#     # Add user so we don't need --no-sandbox.
#     # same layer as npm install to keep re-chowned files from using up several hundred MBs more space
#     && groupadd -r pptruser && useradd -r -g pptruser -G audio,video pptruser \
#     && mkdir -p /home/pptruser/Downloads \
#     && mkdir -p /node_modules \
#     && touch  /package.json \
#     && touch  /package-lock.json \
#     && chown -R pptruser:pptruser /home/pptruser \
#     && chown -R pptruser:pptruser /usr/src/app/node_modules/pa11y/node_modules \
#     && chown -R pptruser:pptruser /node_modules \
#     && chown -R pptruser:pptruser /package.json \
#     && chown -R pptruser:pptruser /package-lock.json

# # Run everything after as non-privileged user.
# FROM node:16
FROM node:18
ENV NODE_ENV=production


# RUN apt-get update && \
# apt-get install -yq gconf-service libasound2 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 \
# libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 \
# libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 \
# libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 \
# fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst \
# ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget && \
# wget https://github.com/Yelp/dumb-init/releases/download/v1.2.1/dumb-init_1.2.1_amd64.deb && \
# dpkg -i dumb-init_*.deb && rm -f dumb-init_*.deb && \
# apt-get clean && apt-get autoremove -y && rm -rf /var/lib/apt/lists/*
# removed 'ttf-freefont' - gave error while downloading. 
RUN apt-get update 
RUN apt-get install -yq gconf-service
RUN apt-get install -yq libasound2
RUN apt-get install -yq libatk1.0-0
RUN apt-get install -yq libc6
RUN apt-get install -yq libcairo2
RUN apt-get install -yq libcups2
RUN apt-get install -yq libdbus-1-3
RUN apt-get install -yq libexpat1
RUN apt-get install -yq libfontconfig1
RUN apt-get install -yq libgcc1
RUN apt-get install -yq libgconf-2-4
RUN apt-get install -yq libgdk-pixbuf2.0-0
RUN apt-get install -yq libglib2.0-0
RUN apt-get install -yq libgtk-3-0
RUN apt-get install -yq libnspr4
RUN apt-get install -yq libpango-1.0-0
RUN apt-get install -yq libpangocairo-1.0-0
RUN apt-get install -yq libstdc++6
RUN apt-get install -yq libx11-6
RUN apt-get install -yq libx11-xcb1
RUN apt-get install -yq libxcb1
RUN apt-get install -yq libxcomposite1
RUN apt-get install -yq libxcursor1
RUN apt-get install -yq libxdamage1
RUN apt-get install -yq libxext6
RUN apt-get install -yq libxfixes3
RUN apt-get install -yq libxi6
RUN apt-get install -yq libxrandr2
RUN apt-get install -yq libxrender1
RUN apt-get install -yq libxss1
RUN apt-get install -yq libxtst6
RUN apt-get install -yq fonts-ipafont-gothic
RUN apt-get install -yq fonts-wqy-zenhei
RUN apt-get install -yq fonts-thai-tlwg
RUN apt-get install -yq fonts-kacst
# RUN apt-get install -yq ttf-freefont
RUN apt-get install -yq ca-certificates
RUN apt-get install -yq fonts-liberation
RUN apt-get install -yq libappindicator1
RUN apt-get install -yq libnss3
RUN apt-get install -yq lsb-release
RUN apt-get install -yq xdg-utils
RUN apt-get install -yq wget
RUN wget https://github.com/Yelp/dumb-init/releases/download/v1.2.1/dumb-init_1.2.1_amd64.deb
RUN dpkg -i dumb-init_*.deb 
RUN rm -f dumb-init_*.deb
RUN apt-get clean 
RUN apt-get autoremove -y 
RUN rm -rf /var/lib/apt/lists/*



# RUN apt-get update 
# RUN apt-get -y install libnss3
# RUN apt-get -y install libatk-bridge2.0-0
# RUN apt-get -y install libdrm-dev
# RUN apt-get -y install libxkbcommon-dev
# RUN apt-get -y install libgbm-dev
# RUN apt-get -y install libasound-dev
# RUN apt-get -y install libatspi2.0-0
# RUN apt-get -y install libxshmfence-dev


# Create app directory
WORKDIR /usr/src/app

# Install app dependencies
# A wildcard is used to ensure both package.json AND package-lock.json are copied
# where available (npm@5+)
COPY package*.json ./


## Added https://github.com/microsoft/playwright/issues/5767
# RUN PLAYWRIGHT_BROWSERS_PATH=/usr/lib/playwright npm install playwright-chromium@1.20.1

# RUN PLAYWRIGHT_BROWSERS_PATH=/usr/lib/playwright npm install playwright-webkit@1.20.1
# RUN PLAYWRIGHT_BROWSERS_PATH=/usr/lib/playwright npm install playwright-firefox@1.20.1


# RUN PLAYWRIGHT_BROWSERS_PATH=/usr/lib/playwright
# ENV PLAYWRIGHT_BROWSERS_PATH=0
# ENV PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD = 1 

RUN npm install
# RUN npx playwright install
# RUN npx playwright install chromium

# If you are building your code for production
# RUN npm ci --only=production

# Bundle app source
COPY . .



EXPOSE 8080
CMD [ "node", "app.js" ]